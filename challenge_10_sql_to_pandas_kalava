{"cells":[{"cell_type":"markdown","metadata":{"id":"ahXiiaOdnu2O"},"source":["# From SQL to pandas challenge 10"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"guOy7w2-nu2h"},"outputs":[],"source":["\n","# import libraries\n","import pandas as pd\n","import numpy as np\n","\n","# load data\n","# This code is made to load our data stored on Google Drive\n","def gd_path(file_id):\n","    \"\"\"Generate a shareable link from Google Drive file id.\"\"\"\n","    return f\"https://drive.google.com/uc?export=download&id={file_id}\"\n","\n","# Google Drive file ids\n","files_id = {\n","    \"titleauthor\": \"1F1JOiYXStWacOBca6coNVfyVtoST7ZgD\",\n","    \"titles\": \"1PLdn50N9GRa53ZbuVWo0l47F_IXdvlEm\",\n","    \"stores\": \"1f-GCgip7O93CpbAkYvOsc21eKnSOSHsQ\", \n","    \"sales\": \"1fzFc9rwYmVIPaGOFmhLVxCi3kg19vNU2\", \n","    \"roysched\": \"1zPRZPoFPEMKyrNR5VSENeYFHGCBZmxbs\", \n","    \"publishers\": \"1s9E8_AVOziTrowb3wyh2jg3PV763VOyq\",\n","    \"pub_info\": \"1OEgogcGKy--EpuVj0kqq7lyBZNGW6YSv\", \n","    \"jobs\": \"1V1Za8hUdXD-vJOyRdX4aQV5wanIff2eM\", \n","    \"employee\": \"1h9mUjsVqpP74b1w0x7KOw37n_n9Ulkt5\", \n","    \"discounts\": \"111dvSxMcCsTgOuV1wDSKFJxO1Xcxd9VS\", \n","    \"authors\": \"1fEF89Nhe61EebAljKlwFwfEuokK0o6aJ\"\n","}\n","\n","# Read data from Google Drive\n","sales = pd.read_csv(gd_path(files_id[\"sales\"]), sep=\";\")\n","titles = pd.read_csv(gd_path(files_id[\"titles\"]), sep=\";\")\n","publishers = pd.read_csv(gd_path(files_id[\"publishers\"]), sep=\";\")\n","\n"]},{"cell_type":"markdown","metadata":{"id":"W-gTb3gmnu2t"},"source":["## 1. Select everything from the sales table and create a new column called \"sales_category\" to categorise qty:\n","   \n","\t\tqty >= 50 high sales\n","\t\t20 <= qty < 50 medium sales\n","\t\tqty < 20 low sales"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":708},"id":"lRZxieQcnu2v","executionInfo":{"status":"ok","timestamp":1674662620272,"user_tz":-60,"elapsed":428,"user":{"displayName":"kalava sivalavanya","userId":"05755290286565672160"}},"outputId":"bf715771-caae-405a-9d83-3be3fcbc064a"},"outputs":[{"output_type":"execute_result","data":{"text/plain":["    stor_id   ord_num             ord_date  qty    payterms title_id  \\\n","0      6380      6871  1994-09-14 00:00:00    5      Net 60   BU1032   \n","1      6380      722a  1994-09-13 00:00:00    3      Net 60   PS2091   \n","2      7066     A2976  1993-05-24 00:00:00   50      Net 30   PC8888   \n","3      7066  QA7442.3  1994-09-13 00:00:00   75  ON invoice   PS2091   \n","4      7067     D4482  1994-09-14 00:00:00   10      Net 60   PS2091   \n","5      7067     P2121  1992-06-15 00:00:00   40      Net 30   TC3218   \n","6      7067     P2121  1992-06-15 00:00:00   20      Net 30   TC4203   \n","7      7067     P2121  1992-06-15 00:00:00   20      Net 30   TC7777   \n","8      7131   N914008  1994-09-14 00:00:00   20      Net 30   PS2091   \n","9      7131   N914014  1994-09-14 00:00:00   25      Net 30   MC3021   \n","10     7131    P3087a  1993-05-29 00:00:00   20      Net 60   PS1372   \n","11     7131    P3087a  1993-05-29 00:00:00   25      Net 60   PS2106   \n","12     7131    P3087a  1993-05-29 00:00:00   15      Net 60   PS3333   \n","13     7131    P3087a  1993-05-29 00:00:00   25      Net 60   PS7777   \n","14     7896    QQ2299  1993-10-28 00:00:00   15      Net 60   BU7832   \n","15     7896     TQ456  1993-12-12 00:00:00   10      Net 60   MC2222   \n","16     7896      X999  1993-02-21 00:00:00   35  ON invoice   BU2075   \n","17     8042  423LL922  1994-09-14 00:00:00   15  ON invoice   MC3021   \n","18     8042  423LL930  1994-09-14 00:00:00   10  ON invoice   BU1032   \n","19     8042      P723  1993-03-11 00:00:00   25      Net 30   BU1111   \n","20     8042   QA879.1  1993-05-22 00:00:00   30      Net 30   PC1035   \n","\n","   sales_category  \n","0       Low Sales  \n","1       Low Sales  \n","2      High Sales  \n","3      High Sales  \n","4       Low Sales  \n","5    Medium Sales  \n","6    Medium Sales  \n","7    Medium Sales  \n","8    Medium Sales  \n","9    Medium Sales  \n","10   Medium Sales  \n","11   Medium Sales  \n","12      Low Sales  \n","13   Medium Sales  \n","14      Low Sales  \n","15      Low Sales  \n","16   Medium Sales  \n","17      Low Sales  \n","18      Low Sales  \n","19   Medium Sales  \n","20   Medium Sales  "],"text/html":["\n","  <div id=\"df-4df25193-65cd-4825-a87b-3c868c03e954\">\n","    <div class=\"colab-df-container\">\n","      <div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th>stor_id</th>\n","      <th>ord_num</th>\n","      <th>ord_date</th>\n","      <th>qty</th>\n","      <th>payterms</th>\n","      <th>title_id</th>\n","      <th>sales_category</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th>0</th>\n","      <td>6380</td>\n","      <td>6871</td>\n","      <td>1994-09-14 00:00:00</td>\n","      <td>5</td>\n","      <td>Net 60</td>\n","      <td>BU1032</td>\n","      <td>Low Sales</td>\n","    </tr>\n","    <tr>\n","      <th>1</th>\n","      <td>6380</td>\n","      <td>722a</td>\n","      <td>1994-09-13 00:00:00</td>\n","      <td>3</td>\n","      <td>Net 60</td>\n","      <td>PS2091</td>\n","      <td>Low Sales</td>\n","    </tr>\n","    <tr>\n","      <th>2</th>\n","      <td>7066</td>\n","      <td>A2976</td>\n","      <td>1993-05-24 00:00:00</td>\n","      <td>50</td>\n","      <td>Net 30</td>\n","      <td>PC8888</td>\n","      <td>High Sales</td>\n","    </tr>\n","    <tr>\n","      <th>3</th>\n","      <td>7066</td>\n","      <td>QA7442.3</td>\n","      <td>1994-09-13 00:00:00</td>\n","      <td>75</td>\n","      <td>ON invoice</td>\n","      <td>PS2091</td>\n","      <td>High Sales</td>\n","    </tr>\n","    <tr>\n","      <th>4</th>\n","      <td>7067</td>\n","      <td>D4482</td>\n","      <td>1994-09-14 00:00:00</td>\n","      <td>10</td>\n","      <td>Net 60</td>\n","      <td>PS2091</td>\n","      <td>Low Sales</td>\n","    </tr>\n","    <tr>\n","      <th>5</th>\n","      <td>7067</td>\n","      <td>P2121</td>\n","      <td>1992-06-15 00:00:00</td>\n","      <td>40</td>\n","      <td>Net 30</td>\n","      <td>TC3218</td>\n","      <td>Medium Sales</td>\n","    </tr>\n","    <tr>\n","      <th>6</th>\n","      <td>7067</td>\n","      <td>P2121</td>\n","      <td>1992-06-15 00:00:00</td>\n","      <td>20</td>\n","      <td>Net 30</td>\n","      <td>TC4203</td>\n","      <td>Medium Sales</td>\n","    </tr>\n","    <tr>\n","      <th>7</th>\n","      <td>7067</td>\n","      <td>P2121</td>\n","      <td>1992-06-15 00:00:00</td>\n","      <td>20</td>\n","      <td>Net 30</td>\n","      <td>TC7777</td>\n","      <td>Medium Sales</td>\n","    </tr>\n","    <tr>\n","      <th>8</th>\n","      <td>7131</td>\n","      <td>N914008</td>\n","      <td>1994-09-14 00:00:00</td>\n","      <td>20</td>\n","      <td>Net 30</td>\n","      <td>PS2091</td>\n","      <td>Medium Sales</td>\n","    </tr>\n","    <tr>\n","      <th>9</th>\n","      <td>7131</td>\n","      <td>N914014</td>\n","      <td>1994-09-14 00:00:00</td>\n","      <td>25</td>\n","      <td>Net 30</td>\n","      <td>MC3021</td>\n","      <td>Medium Sales</td>\n","    </tr>\n","    <tr>\n","      <th>10</th>\n","      <td>7131</td>\n","      <td>P3087a</td>\n","      <td>1993-05-29 00:00:00</td>\n","      <td>20</td>\n","      <td>Net 60</td>\n","      <td>PS1372</td>\n","      <td>Medium Sales</td>\n","    </tr>\n","    <tr>\n","      <th>11</th>\n","      <td>7131</td>\n","      <td>P3087a</td>\n","      <td>1993-05-29 00:00:00</td>\n","      <td>25</td>\n","      <td>Net 60</td>\n","      <td>PS2106</td>\n","      <td>Medium Sales</td>\n","    </tr>\n","    <tr>\n","      <th>12</th>\n","      <td>7131</td>\n","      <td>P3087a</td>\n","      <td>1993-05-29 00:00:00</td>\n","      <td>15</td>\n","      <td>Net 60</td>\n","      <td>PS3333</td>\n","      <td>Low Sales</td>\n","    </tr>\n","    <tr>\n","      <th>13</th>\n","      <td>7131</td>\n","      <td>P3087a</td>\n","      <td>1993-05-29 00:00:00</td>\n","      <td>25</td>\n","      <td>Net 60</td>\n","      <td>PS7777</td>\n","      <td>Medium Sales</td>\n","    </tr>\n","    <tr>\n","      <th>14</th>\n","      <td>7896</td>\n","      <td>QQ2299</td>\n","      <td>1993-10-28 00:00:00</td>\n","      <td>15</td>\n","      <td>Net 60</td>\n","      <td>BU7832</td>\n","      <td>Low Sales</td>\n","    </tr>\n","    <tr>\n","      <th>15</th>\n","      <td>7896</td>\n","      <td>TQ456</td>\n","      <td>1993-12-12 00:00:00</td>\n","      <td>10</td>\n","      <td>Net 60</td>\n","      <td>MC2222</td>\n","      <td>Low Sales</td>\n","    </tr>\n","    <tr>\n","      <th>16</th>\n","      <td>7896</td>\n","      <td>X999</td>\n","      <td>1993-02-21 00:00:00</td>\n","      <td>35</td>\n","      <td>ON invoice</td>\n","      <td>BU2075</td>\n","      <td>Medium Sales</td>\n","    </tr>\n","    <tr>\n","      <th>17</th>\n","      <td>8042</td>\n","      <td>423LL922</td>\n","      <td>1994-09-14 00:00:00</td>\n","      <td>15</td>\n","      <td>ON invoice</td>\n","      <td>MC3021</td>\n","      <td>Low Sales</td>\n","    </tr>\n","    <tr>\n","      <th>18</th>\n","      <td>8042</td>\n","      <td>423LL930</td>\n","      <td>1994-09-14 00:00:00</td>\n","      <td>10</td>\n","      <td>ON invoice</td>\n","      <td>BU1032</td>\n","      <td>Low Sales</td>\n","    </tr>\n","    <tr>\n","      <th>19</th>\n","      <td>8042</td>\n","      <td>P723</td>\n","      <td>1993-03-11 00:00:00</td>\n","      <td>25</td>\n","      <td>Net 30</td>\n","      <td>BU1111</td>\n","      <td>Medium Sales</td>\n","    </tr>\n","    <tr>\n","      <th>20</th>\n","      <td>8042</td>\n","      <td>QA879.1</td>\n","      <td>1993-05-22 00:00:00</td>\n","      <td>30</td>\n","      <td>Net 30</td>\n","      <td>PC1035</td>\n","      <td>Medium Sales</td>\n","    </tr>\n","  </tbody>\n","</table>\n","</div>\n","      <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-4df25193-65cd-4825-a87b-3c868c03e954')\"\n","              title=\"Convert this dataframe to an interactive table.\"\n","              style=\"display:none;\">\n","        \n","  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n","       width=\"24px\">\n","    <path d=\"M0 0h24v24H0V0z\" fill=\"none\"/>\n","    <path d=\"M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z\"/><path d=\"M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z\"/>\n","  </svg>\n","      </button>\n","      \n","  <style>\n","    .colab-df-container {\n","      display:flex;\n","      flex-wrap:wrap;\n","      gap: 12px;\n","    }\n","\n","    .colab-df-convert {\n","      background-color: #E8F0FE;\n","      border: none;\n","      border-radius: 50%;\n","      cursor: pointer;\n","      display: none;\n","      fill: #1967D2;\n","      height: 32px;\n","      padding: 0 0 0 0;\n","      width: 32px;\n","    }\n","\n","    .colab-df-convert:hover {\n","      background-color: #E2EBFA;\n","      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n","      fill: #174EA6;\n","    }\n","\n","    [theme=dark] .colab-df-convert {\n","      background-color: #3B4455;\n","      fill: #D2E3FC;\n","    }\n","\n","    [theme=dark] .colab-df-convert:hover {\n","      background-color: #434B5C;\n","      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n","      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n","      fill: #FFFFFF;\n","    }\n","  </style>\n","\n","      <script>\n","        const buttonEl =\n","          document.querySelector('#df-4df25193-65cd-4825-a87b-3c868c03e954 button.colab-df-convert');\n","        buttonEl.style.display =\n","          google.colab.kernel.accessAllowed ? 'block' : 'none';\n","\n","        async function convertToInteractive(key) {\n","          const element = document.querySelector('#df-4df25193-65cd-4825-a87b-3c868c03e954');\n","          const dataTable =\n","            await google.colab.kernel.invokeFunction('convertToInteractive',\n","                                                     [key], {});\n","          if (!dataTable) return;\n","\n","          const docLinkHtml = 'Like what you see? Visit the ' +\n","            '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n","            + ' to learn more about interactive tables.';\n","          element.innerHTML = '';\n","          dataTable['output_type'] = 'display_data';\n","          await google.colab.output.renderOutput(dataTable, element);\n","          const docLink = document.createElement('div');\n","          docLink.innerHTML = docLinkHtml;\n","          element.appendChild(docLink);\n","        }\n","      </script>\n","    </div>\n","  </div>\n","  "]},"metadata":{},"execution_count":2}],"source":["condition=[(sales['qty'] >= 50) , (sales['qty'] >= 20) & (sales['qty'] < 50) , (sales['qty']<20)]\n","values=['High Sales','Medium Sales','Low Sales']\n","sales['sales_category'] =np.select(condition,values,default = 'low sales')\n","sales"]},{"cell_type":"markdown","metadata":{"id":"Qfp5FJAxnu2x"},"source":["### Hint:"]},{"cell_type":"markdown","metadata":{"id":"NBvCY3nknu2y"},"source":["In SQL the syntax is:\n","\n","```sql\n","SELECT *,\n","CASE\n","    WHEN qty >= 50 THEN \"high sales\"\n","    WHEN qty >= 20 THEN \"medium sales\"\n","    ELSE \"low sales\"\n","END AS sales_category\n","FROM sales;\n","```"]},{"cell_type":"markdown","metadata":{"id":"seXsRtMqnu2z"},"source":["## 2. Adding to your answer from the previous question. Find out the total amount of books sold (qty) in each sales category \n","    i.e. How many books had high sales, how many had medium sales, and how many had low sales"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":175},"id":"9YjIQaiUnu26","executionInfo":{"status":"ok","timestamp":1674663031003,"user_tz":-60,"elapsed":607,"user":{"displayName":"kalava sivalavanya","userId":"05755290286565672160"}},"outputId":"c02af0c0-fda4-440f-d111-26c0fe77a563"},"outputs":[{"output_type":"execute_result","data":{"text/plain":["                qty\n","sales_category     \n","high sales      125\n","low sales        83\n","medium sales    285"],"text/html":["\n","  <div id=\"df-20895915-d3f6-494c-b732-93494eac996b\">\n","    <div class=\"colab-df-container\">\n","      <div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th>qty</th>\n","    </tr>\n","    <tr>\n","      <th>sales_category</th>\n","      <th></th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th>high sales</th>\n","      <td>125</td>\n","    </tr>\n","    <tr>\n","      <th>low sales</th>\n","      <td>83</td>\n","    </tr>\n","    <tr>\n","      <th>medium sales</th>\n","      <td>285</td>\n","    </tr>\n","  </tbody>\n","</table>\n","</div>\n","      <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-20895915-d3f6-494c-b732-93494eac996b')\"\n","              title=\"Convert this dataframe to an interactive table.\"\n","              style=\"display:none;\">\n","        \n","  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n","       width=\"24px\">\n","    <path d=\"M0 0h24v24H0V0z\" fill=\"none\"/>\n","    <path d=\"M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z\"/><path d=\"M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z\"/>\n","  </svg>\n","      </button>\n","      \n","  <style>\n","    .colab-df-container {\n","      display:flex;\n","      flex-wrap:wrap;\n","      gap: 12px;\n","    }\n","\n","    .colab-df-convert {\n","      background-color: #E8F0FE;\n","      border: none;\n","      border-radius: 50%;\n","      cursor: pointer;\n","      display: none;\n","      fill: #1967D2;\n","      height: 32px;\n","      padding: 0 0 0 0;\n","      width: 32px;\n","    }\n","\n","    .colab-df-convert:hover {\n","      background-color: #E2EBFA;\n","      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n","      fill: #174EA6;\n","    }\n","\n","    [theme=dark] .colab-df-convert {\n","      background-color: #3B4455;\n","      fill: #D2E3FC;\n","    }\n","\n","    [theme=dark] .colab-df-convert:hover {\n","      background-color: #434B5C;\n","      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n","      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n","      fill: #FFFFFF;\n","    }\n","  </style>\n","\n","      <script>\n","        const buttonEl =\n","          document.querySelector('#df-20895915-d3f6-494c-b732-93494eac996b button.colab-df-convert');\n","        buttonEl.style.display =\n","          google.colab.kernel.accessAllowed ? 'block' : 'none';\n","\n","        async function convertToInteractive(key) {\n","          const element = document.querySelector('#df-20895915-d3f6-494c-b732-93494eac996b');\n","          const dataTable =\n","            await google.colab.kernel.invokeFunction('convertToInteractive',\n","                                                     [key], {});\n","          if (!dataTable) return;\n","\n","          const docLinkHtml = 'Like what you see? Visit the ' +\n","            '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n","            + ' to learn more about interactive tables.';\n","          element.innerHTML = '';\n","          dataTable['output_type'] = 'display_data';\n","          await google.colab.output.renderOutput(dataTable, element);\n","          const docLink = document.createElement('div');\n","          docLink.innerHTML = docLinkHtml;\n","          element.appendChild(docLink);\n","        }\n","      </script>\n","    </div>\n","  </div>\n","  "]},"metadata":{},"execution_count":4}],"source":["condition = [(sales[\"qty\"]>=50), ((sales[\"qty\"]>= 20) & (sales[\"qty\"]<50)), (sales[\"qty\"]<20)]\n","values = [\"high sales\", \"medium sales\", \"low sales\"]\n","sales[\"sales_category\"] = np.select(condition,values,default = \"low values\")\n","sales.groupby(\"sales_category\").agg({\"qty\": \"sum\"})"]},{"cell_type":"markdown","metadata":{"id":"u2X57q9Onu27"},"source":["### Hint:"]},{"cell_type":"markdown","metadata":{"id":"6lloxQgXnu28"},"source":["In SQL the syntax is:\n","\n","```sql\n","SELECT sum(qty),\n","CASE\n","\tWHEN qty>=50 THEN 'high sales'\n","    WHEN (qty>=20 AND qty<50) THEN 'medium sales'\n","    ELSE 'low sales'\n","END AS sales_category\n","FROM sales\n","GROUP BY sales_category;\n","```"]},{"cell_type":"markdown","metadata":{"id":"gLjieU-Mnu29"},"source":["## 3. Adding to your answer from the previous questions: output only those sales categories that have a SUM(qty) greater than 100, and order them in descending order"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":143},"id":"JmfZFYqanu2-","executionInfo":{"status":"ok","timestamp":1674663292169,"user_tz":-60,"elapsed":409,"user":{"displayName":"kalava sivalavanya","userId":"05755290286565672160"}},"outputId":"480ea132-9c3b-4624-85cd-b12a76864e0c"},"outputs":[{"output_type":"execute_result","data":{"text/plain":["                qty\n","sales_category     \n","medium sales    285\n","high sales      125"],"text/html":["\n","  <div id=\"df-2751835e-7e50-493b-b699-486d9f2d1765\">\n","    <div class=\"colab-df-container\">\n","      <div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th>qty</th>\n","    </tr>\n","    <tr>\n","      <th>sales_category</th>\n","      <th></th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th>medium sales</th>\n","      <td>285</td>\n","    </tr>\n","    <tr>\n","      <th>high sales</th>\n","      <td>125</td>\n","    </tr>\n","  </tbody>\n","</table>\n","</div>\n","      <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-2751835e-7e50-493b-b699-486d9f2d1765')\"\n","              title=\"Convert this dataframe to an interactive table.\"\n","              style=\"display:none;\">\n","        \n","  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n","       width=\"24px\">\n","    <path d=\"M0 0h24v24H0V0z\" fill=\"none\"/>\n","    <path d=\"M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z\"/><path d=\"M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z\"/>\n","  </svg>\n","      </button>\n","      \n","  <style>\n","    .colab-df-container {\n","      display:flex;\n","      flex-wrap:wrap;\n","      gap: 12px;\n","    }\n","\n","    .colab-df-convert {\n","      background-color: #E8F0FE;\n","      border: none;\n","      border-radius: 50%;\n","      cursor: pointer;\n","      display: none;\n","      fill: #1967D2;\n","      height: 32px;\n","      padding: 0 0 0 0;\n","      width: 32px;\n","    }\n","\n","    .colab-df-convert:hover {\n","      background-color: #E2EBFA;\n","      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n","      fill: #174EA6;\n","    }\n","\n","    [theme=dark] .colab-df-convert {\n","      background-color: #3B4455;\n","      fill: #D2E3FC;\n","    }\n","\n","    [theme=dark] .colab-df-convert:hover {\n","      background-color: #434B5C;\n","      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n","      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n","      fill: #FFFFFF;\n","    }\n","  </style>\n","\n","      <script>\n","        const buttonEl =\n","          document.querySelector('#df-2751835e-7e50-493b-b699-486d9f2d1765 button.colab-df-convert');\n","        buttonEl.style.display =\n","          google.colab.kernel.accessAllowed ? 'block' : 'none';\n","\n","        async function convertToInteractive(key) {\n","          const element = document.querySelector('#df-2751835e-7e50-493b-b699-486d9f2d1765');\n","          const dataTable =\n","            await google.colab.kernel.invokeFunction('convertToInteractive',\n","                                                     [key], {});\n","          if (!dataTable) return;\n","\n","          const docLinkHtml = 'Like what you see? Visit the ' +\n","            '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n","            + ' to learn more about interactive tables.';\n","          element.innerHTML = '';\n","          dataTable['output_type'] = 'display_data';\n","          await google.colab.output.renderOutput(dataTable, element);\n","          const docLink = document.createElement('div');\n","          docLink.innerHTML = docLinkHtml;\n","          element.appendChild(docLink);\n","        }\n","      </script>\n","    </div>\n","  </div>\n","  "]},"metadata":{},"execution_count":7}],"source":["condition = [(sales[\"qty\"]>=50), ((sales[\"qty\"]>= 20) & (sales[\"qty\"]<50)), (sales[\"qty\"]<20)]\n","values = [\"high sales\", \"medium sales\", \"low sales\"]\n","sales[\"sales_category\"] = np.select(condition,values,default = \"low values\")\n","df = sales.groupby(\"sales_category\").agg({\"qty\": \"sum\"})\n","df.reset_index()\n","df[df[\"qty\"]> 100].sort_values(by = \"qty\", ascending = False)\n"]},{"cell_type":"markdown","metadata":{"id":"cxAql2vfnu2-"},"source":["### Hint:"]},{"cell_type":"markdown","metadata":{"id":"hSI0-Z0Mnu2_"},"source":["In SQL the syntax is:\n","\n","```sql\n","SELECT sum(qty),\n","CASE\n","    WHEN qty>=50 THEN 'high sales'\n","    WHEN (qty>=20 AND qty<50) THEN 'medium sales'\n","    ELSE 'low sales'\n","END AS sales_category\n","FROM sales\n","GROUP BY sales_category\n","HAVING sum(qty)>100\n","ORDER BY sum(qty) DESC;\n","```"]},{"cell_type":"markdown","metadata":{"id":"OHwnTzVZnu3A"},"source":["## 4. Find out the average book price, per publisher, for the following book types and price categories:\n","\t\tbook types: business, traditional cook and psychology\n","\t\tprice categories: <= 5 super low, <= 10 low, <= 15 medium, > 15 high\n","        \n","        - When displaying the average prices, use ROUND() to hide decimals."]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":206},"id":"bOH6Y345nu3B","executionInfo":{"status":"ok","timestamp":1674665356009,"user_tz":-60,"elapsed":467,"user":{"displayName":"kalava sivalavanya","userId":"05755290286565672160"}},"outputId":"bb847609-96ed-47c2-ca8b-6cfc726307f8"},"outputs":[{"output_type":"execute_result","data":{"text/plain":["   pub_id        type  price price_category\n","0     736    business    3.0      super low\n","1     736  psychology   11.0         medium\n","4     877  psychology   22.0           high\n","5     877   trad_cook   16.0           high\n","6    1389    business   17.0           high"],"text/html":["\n","  <div id=\"df-af10e39e-92be-4f2d-a428-c29b22785351\">\n","    <div class=\"colab-df-container\">\n","      <div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th>pub_id</th>\n","      <th>type</th>\n","      <th>price</th>\n","      <th>price_category</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th>0</th>\n","      <td>736</td>\n","      <td>business</td>\n","      <td>3.0</td>\n","      <td>super low</td>\n","    </tr>\n","    <tr>\n","      <th>1</th>\n","      <td>736</td>\n","      <td>psychology</td>\n","      <td>11.0</td>\n","      <td>medium</td>\n","    </tr>\n","    <tr>\n","      <th>4</th>\n","      <td>877</td>\n","      <td>psychology</td>\n","      <td>22.0</td>\n","      <td>high</td>\n","    </tr>\n","    <tr>\n","      <th>5</th>\n","      <td>877</td>\n","      <td>trad_cook</td>\n","      <td>16.0</td>\n","      <td>high</td>\n","    </tr>\n","    <tr>\n","      <th>6</th>\n","      <td>1389</td>\n","      <td>business</td>\n","      <td>17.0</td>\n","      <td>high</td>\n","    </tr>\n","  </tbody>\n","</table>\n","</div>\n","      <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-af10e39e-92be-4f2d-a428-c29b22785351')\"\n","              title=\"Convert this dataframe to an interactive table.\"\n","              style=\"display:none;\">\n","        \n","  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n","       width=\"24px\">\n","    <path d=\"M0 0h24v24H0V0z\" fill=\"none\"/>\n","    <path d=\"M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z\"/><path d=\"M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z\"/>\n","  </svg>\n","      </button>\n","      \n","  <style>\n","    .colab-df-container {\n","      display:flex;\n","      flex-wrap:wrap;\n","      gap: 12px;\n","    }\n","\n","    .colab-df-convert {\n","      background-color: #E8F0FE;\n","      border: none;\n","      border-radius: 50%;\n","      cursor: pointer;\n","      display: none;\n","      fill: #1967D2;\n","      height: 32px;\n","      padding: 0 0 0 0;\n","      width: 32px;\n","    }\n","\n","    .colab-df-convert:hover {\n","      background-color: #E2EBFA;\n","      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n","      fill: #174EA6;\n","    }\n","\n","    [theme=dark] .colab-df-convert {\n","      background-color: #3B4455;\n","      fill: #D2E3FC;\n","    }\n","\n","    [theme=dark] .colab-df-convert:hover {\n","      background-color: #434B5C;\n","      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n","      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n","      fill: #FFFFFF;\n","    }\n","  </style>\n","\n","      <script>\n","        const buttonEl =\n","          document.querySelector('#df-af10e39e-92be-4f2d-a428-c29b22785351 button.colab-df-convert');\n","        buttonEl.style.display =\n","          google.colab.kernel.accessAllowed ? 'block' : 'none';\n","\n","        async function convertToInteractive(key) {\n","          const element = document.querySelector('#df-af10e39e-92be-4f2d-a428-c29b22785351');\n","          const dataTable =\n","            await google.colab.kernel.invokeFunction('convertToInteractive',\n","                                                     [key], {});\n","          if (!dataTable) return;\n","\n","          const docLinkHtml = 'Like what you see? Visit the ' +\n","            '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n","            + ' to learn more about interactive tables.';\n","          element.innerHTML = '';\n","          dataTable['output_type'] = 'display_data';\n","          await google.colab.output.renderOutput(dataTable, element);\n","          const docLink = document.createElement('div');\n","          docLink.innerHTML = docLinkHtml;\n","          element.appendChild(docLink);\n","        }\n","      </script>\n","    </div>\n","  </div>\n","  "]},"metadata":{},"execution_count":24}],"source":["\n","title_pub_df=( titles.merge(publishers,on='pub_id',how='left')\n","                     .groupby(['pub_id','type'])\n","                     .agg({'price':'mean'}).round()\n","                     .reset_index()\n","              )\n","\n","title_pub_df['price_category'] = np.where(title_pub_df['price']<=5 , 'super low',\n","                           np.where((title_pub_df['price']>5) & (title_pub_df['price']<=10), 'low',\n","                           np.where((title_pub_df['price']>10) & (title_pub_df['price']<=15), 'medium',\n","                           np.where(title_pub_df['price']>15, 'high', \"high\"))))\n","\n","\n","title_pub_df[title_pub_df[\"type\"].isin([\"business\", \"trad_cook\", \"psychology\"])]\n","\n"]},{"cell_type":"markdown","metadata":{"id":"F4iCeojLnu3B"},"source":["### Hint:"]},{"cell_type":"markdown","metadata":{"id":"_PwWZZHmnu3C"},"source":["In SQL the syntax is:\n","\n","```sql\n","SELECT\n","    ROUND(AVG(price)),\n","    type,\n","    pub_name,\n","CASE\n","    WHEN price <= 5 THEN 'super low'\n","    WHEN (price > 5 AND price <= 10) THEN 'low'\n","    WHEN (price > 10 AND price <= 15) THEN 'medium'\n","    ELSE 'high'\n","END AS price_category\n","FROM titles\n","LEFT JOIN publishers\n","ON titles.pub_id=publishers.pub_id\n","GROUP BY\n","    pub_name,\n","    type,\n","    price_category\n","HAVING\n","    type IN ('business', 'trad_cook', 'psychology');\n","```"]}],"metadata":{"kernelspec":{"display_name":"base","language":"python","name":"python3"},"language_info":{"codemirror_mode":{"name":"ipython","version":3},"file_extension":".py","mimetype":"text/x-python","name":"python","nbconvert_exporter":"python","pygments_lexer":"ipython3","version":"3.9.15 (main, Nov  4 2022, 16:35:55) [MSC v.1916 64 bit (AMD64)]"},"orig_nbformat":4,"vscode":{"interpreter":{"hash":"ad2bdc8ecc057115af97d19610ffacc2b4e99fae6737bb82f5d7fb13d2f2c186"}},"colab":{"provenance":[{"file_id":"15YAfXMcGe-y_tzeyTQEs73olsLJkRVua","timestamp":1674663554718}]}},"nbformat":4,"nbformat_minor":0}